!function(e){var n={};function r(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=n,r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,n){if(1&n&&(e=r(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)r.d(t,i,function(n){return e[n]}.bind(null,i));return t},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.p="",r(r.s=17)}([function(e,n){e.exports=require("passport")},function(e,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var t=r(12),i=r(13).typeDefs;console.log(process.env);n.Prisma=t.makePrismaClientClass({typeDefs:i,models:[{name:"User",embedded:!1}],endpoint:"http://".concat(process.env.PRISMA_HOST,":").concat(process.env.PRISMA_PORT)}),n.prisma=new n.Prisma},function(e,n){e.exports=require("graphql")},function(e,n,r){e.exports=r(14)},function(e,n){e.exports=require("express-session")},function(e,n){e.exports=require("bcrypt")},function(e,n){e.exports=require("express")},function(e,n){e.exports=require("express-graphql")},function(e,n){e.exports=require("redis")},function(e,n){e.exports=require("dotenv")},function(e,n){e.exports=require("next")},function(e,n){e.exports=require("@babel/polyfill")},function(e,n){e.exports=require("prisma-client-lib")},function(e,n){e.exports={typeDefs:"type AggregateUser {\n  count: Int!\n}\n\ntype BatchPayload {\n  count: Long!\n}\n\nscalar Long\n\ntype Mutation {\n  createUser(data: UserCreateInput!): User!\n  updateUser(data: UserUpdateInput!, where: UserWhereUniqueInput!): User\n  updateManyUsers(data: UserUpdateManyMutationInput!, where: UserWhereInput): BatchPayload!\n  upsertUser(where: UserWhereUniqueInput!, create: UserCreateInput!, update: UserUpdateInput!): User!\n  deleteUser(where: UserWhereUniqueInput!): User\n  deleteManyUsers(where: UserWhereInput): BatchPayload!\n}\n\nenum MutationType {\n  CREATED\n  UPDATED\n  DELETED\n}\n\ninterface Node {\n  id: ID!\n}\n\ntype PageInfo {\n  hasNextPage: Boolean!\n  hasPreviousPage: Boolean!\n  startCursor: String\n  endCursor: String\n}\n\ntype Query {\n  user(where: UserWhereUniqueInput!): User\n  users(where: UserWhereInput, orderBy: UserOrderByInput, skip: Int, after: String, before: String, first: Int, last: Int): [User]!\n  usersConnection(where: UserWhereInput, orderBy: UserOrderByInput, skip: Int, after: String, before: String, first: Int, last: Int): UserConnection!\n  node(id: ID!): Node\n}\n\ntype Subscription {\n  user(where: UserSubscriptionWhereInput): UserSubscriptionPayload\n}\n\ntype User {\n  id: ID!\n  email: String\n  name: String\n  password: String!\n}\n\ntype UserConnection {\n  pageInfo: PageInfo!\n  edges: [UserEdge]!\n  aggregate: AggregateUser!\n}\n\ninput UserCreateInput {\n  email: String\n  name: String\n  password: String!\n}\n\ntype UserEdge {\n  node: User!\n  cursor: String!\n}\n\nenum UserOrderByInput {\n  id_ASC\n  id_DESC\n  email_ASC\n  email_DESC\n  name_ASC\n  name_DESC\n  password_ASC\n  password_DESC\n}\n\ntype UserPreviousValues {\n  id: ID!\n  email: String\n  name: String\n  password: String!\n}\n\ntype UserSubscriptionPayload {\n  mutation: MutationType!\n  node: User\n  updatedFields: [String!]\n  previousValues: UserPreviousValues\n}\n\ninput UserSubscriptionWhereInput {\n  mutation_in: [MutationType!]\n  updatedFields_contains: String\n  updatedFields_contains_every: [String!]\n  updatedFields_contains_some: [String!]\n  node: UserWhereInput\n  AND: [UserSubscriptionWhereInput!]\n  OR: [UserSubscriptionWhereInput!]\n  NOT: [UserSubscriptionWhereInput!]\n}\n\ninput UserUpdateInput {\n  email: String\n  name: String\n  password: String\n}\n\ninput UserUpdateManyMutationInput {\n  email: String\n  name: String\n  password: String\n}\n\ninput UserWhereInput {\n  id: ID\n  id_not: ID\n  id_in: [ID!]\n  id_not_in: [ID!]\n  id_lt: ID\n  id_lte: ID\n  id_gt: ID\n  id_gte: ID\n  id_contains: ID\n  id_not_contains: ID\n  id_starts_with: ID\n  id_not_starts_with: ID\n  id_ends_with: ID\n  id_not_ends_with: ID\n  email: String\n  email_not: String\n  email_in: [String!]\n  email_not_in: [String!]\n  email_lt: String\n  email_lte: String\n  email_gt: String\n  email_gte: String\n  email_contains: String\n  email_not_contains: String\n  email_starts_with: String\n  email_not_starts_with: String\n  email_ends_with: String\n  email_not_ends_with: String\n  name: String\n  name_not: String\n  name_in: [String!]\n  name_not_in: [String!]\n  name_lt: String\n  name_lte: String\n  name_gt: String\n  name_gte: String\n  name_contains: String\n  name_not_contains: String\n  name_starts_with: String\n  name_not_starts_with: String\n  name_ends_with: String\n  name_not_ends_with: String\n  password: String\n  password_not: String\n  password_in: [String!]\n  password_not_in: [String!]\n  password_lt: String\n  password_lte: String\n  password_gt: String\n  password_gte: String\n  password_contains: String\n  password_not_contains: String\n  password_starts_with: String\n  password_not_starts_with: String\n  password_ends_with: String\n  password_not_ends_with: String\n  AND: [UserWhereInput!]\n  OR: [UserWhereInput!]\n  NOT: [UserWhereInput!]\n}\n\ninput UserWhereUniqueInput {\n  id: ID\n  email: String\n}\n"}},function(e,n){},function(e,n){e.exports=require("http2")},function(e,n){e.exports=require("connect-redis")},function(e,n,r){"use strict";r.r(n);var t=r(6),i=r.n(t),s=(r(10),r(7)),a=r.n(s),o=r(4),u=r.n(o),p=r(0),c=r.n(p),d=r(2),l=d.GraphQLObjectType,g=d.GraphQLString,f=d.GraphQLID,m=new l({name:"UserType",fields:{id:{type:f},email:{type:g},password:{type:g},name:{type:g}}}),_=new l({name:"UserPayload",fields:{userId:{type:f},code:{type:f},message:{type:g}}});var h=r(2),S=h.GraphQLObjectType,y=h.GraphQLString,w=(h.GraphQLID,h.GraphQLEnumType,h.GraphQLInt),v=(h.GraphQLList,new S({name:"SessionType",fields:{maxAge:{type:w},revalidateAge:{type:w},user:{type:m,args:function(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}({email:{type:y}},"email",{type:y})}}})),U=(r(11),r(5)),I=r.n(U),b=r(1),x=r(3);function P(e,n,r,t,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return void r(e)}o.done?n(u):Promise.resolve(u).then(t,i)}function D(e){return function(){var n=this,r=arguments;return new Promise(function(t,i){var s=e.apply(n,r);function a(e){P(s,t,i,a,o,"next",e)}function o(e){P(s,t,i,a,o,"throw",e)}a(void 0)})}}function O(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}var q=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r,t;return n=e,r=null,t=[{key:"session",value:function(){var e=D(regeneratorRuntime.mark(function e(n){var r,t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.req,t={maxAge:x.sessionMaxAge,revalidateAge:x.sessionRevalidateAge},r.user&&(t.user=r.user),e.abrupt("return",t);case 4:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}()},{key:"createUser",value:function(){var e=D(regeneratorRuntime.mark(function e(n){var r,t,i,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.name,t=n.email,i=n.password,t&&i){e.next=3;break}throw new Error("Email & Password are needed");case 3:return e.next=5,b.prisma.$exists.user({email:t});case 5:if(!e.sent){e.next=10;break}throw new Error("User already here");case 10:return e.next=12,I.a.hash(i,10);case 12:return s=e.sent,i=s,e.next=16,b.prisma.createUser({email:t,password:i,name:r});case 16:if(!(a=e.sent)){e.next=19;break}return e.abrupt("return",{userId:a.id,code:200,message:"success"});case 19:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}()},{key:"loginUser",value:function(){var e=D(regeneratorRuntime.mark(function e(n){var r,t,i,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.req,t=n.email,i=n.password,t&&i){e.next=3;break}throw new Error("Email & Password are needed");case 3:return e.next=5,b.prisma.user({email:t});case 5:if(s=e.sent){e.next=10;break}throw new Error("User not found!");case 10:return e.next=12,I.a.compare(i,s.password);case 12:if(a=e.sent){e.next=15;break}throw new Error("Wrong username or password");case 15:return e.abrupt("return",new Promise(function(e,n){a&&r.login(s,function(r){r&&n(r),e({userId:s.id,code:200,message:"success"})})}));case 16:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}()}],r&&O(n.prototype,r),t&&O(n,t),e}(),T=r(2),E=T.GraphQLObjectType,C=(T.GraphQLID,new E({name:"RootQueryType",fields:{user:{type:m,resolve:function(e,n,r){return r.user}},session:{type:v,resolve:function(e,n,r){return q.session({req:r})}}}})),R=r(2),W=R.GraphQLObjectType,k=R.GraphQLString,M=new W({name:"Mutation",fields:{session:{type:v,resolve:function(e,n,r){return q.session({req:r})}},signup:{type:_,args:{email:{type:k},password:{type:k},name:{type:k}},resolve:function(e,n,r){var t=n.email,i=n.password,s=n.name;return q.createUser({context:r,email:t,password:i,name:s})}},logout:{type:m,resolve:function(e,n,r){r.user;return null}},login:{type:_,args:{email:{type:k},password:{type:k},message:{type:k}},resolve:function(e,n,r){var t=n.email,i=n.password;return q.loginUser({email:t,password:i,req:r})}}}}),A=new(0,r(2).GraphQLSchema)({query:C,mutation:M});function L(e,n,r,t,i,s,a){try{var o=e[s](a),u=o.value}catch(e){return void r(e)}o.done?n(u):Promise.resolve(u).then(t,i)}var j=function(e){return new Promise(function(){var n,r=(n=regeneratorRuntime.mark(function n(r,t){var i;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,b.prisma.user({id:e});case 2:if(i=n.sent){n.next=5;break}return n.abrupt("return",r(null));case 5:return n.abrupt("return",r({id:i.id,email:i.email}));case 6:case"end":return n.stop()}},n)}),function(){var e=this,r=arguments;return new Promise(function(t,i){var s=n.apply(e,r);function a(e){L(s,t,i,a,o,"next",e)}function o(e){L(s,t,i,a,o,"throw",e)}a(void 0)})});return function(e,n){return r.apply(this,arguments)}}())},Q=r(8),G=r.n(Q);r(15);r(9).config();var B=r(16)(u.a),N=G.a.createClient();N.monitor(function(e,n){console.log(n)});var z=i()();z.use(u()({name:"apdp-session-id",store:new B({host:process.env.REDIS_HOST,port:process.env.REDIS_PORT,client:N,ttl:20}),resave:!1,saveUninitialized:!0,secret:"secret"})),z.use(c.a.initialize()),z.use(c.a.session()),function(e){e.server;c.a.serializeUser(function(e,n){(function(e){return e.id?Promise.resolve(e.id):e._id?Promise.resolve(e._id):Promise.reject(new Error("Unable to serialise user"))})(e).then(function(e){n(null,e)}).catch(function(e){n(e,!1)})}),c.a.deserializeUser(function(e,n){j(e).then(function(e){if(!e)return n(null,!1);n(null,e)}).catch(function(e){n(e,!1)})})}({server:z}),z.get("/api",function(e,n){n.json({message:"success"})}),z.use("/auth",a()({schema:A,graphiql:!0})),z.listen(process.env.PORT,process.env.HOST,function(){return console.log("Backend running at ".concat(process.env.HOST,":").concat(process.env.PORT))})}]);